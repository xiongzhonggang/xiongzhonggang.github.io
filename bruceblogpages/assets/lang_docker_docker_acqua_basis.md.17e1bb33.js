import{_ as s,o as n,c as a,a as l}from"./app.1e2723c3.js";const e="/bruceblogpages/assets/mysql_install.4f9c7079.png",t="/bruceblogpages/assets/docker.94a4eb33.png",p="/bruceblogpages/assets/mysql.370c3980.png",o="/bruceblogpages/assets/docker_params.e5275684.png",r="/bruceblogpages/assets/docker_run.81617dae.png",c="/bruceblogpages/assets/data_jun.26af4858.png",i="/bruceblogpages/assets/images-construction.b2b06c78.png",d="/bruceblogpages/assets/dockerfile.b5388b1e.png",y="/bruceblogpages/assets/dockerfile-2.ec599c1d.png",C="/bruceblogpages/assets/network.e157eac5.png",D="/bruceblogpages/assets/dem_2.973afabe.png",A="/bruceblogpages/assets/dockerCompose.621d4341.png",b="/bruceblogpages/assets/dockerCompose_2.3d67bdad.png",q=JSON.parse('{"title":"Docker","description":"","frontmatter":{},"headers":[{"level":2,"title":"1.Docker 快速入门","slug":"_1-docker-快速入门","link":"#_1-docker-快速入门","children":[{"level":3,"title":"1.1部署MYSQL","slug":"_1-1部署mysql","link":"#_1-1部署mysql","children":[]}]},{"level":2,"title":"镜像和容器","slug":"镜像和容器","link":"#镜像和容器","children":[]},{"level":2,"title":"Docker 介绍","slug":"docker-介绍","link":"#docker-介绍","children":[]},{"level":2,"title":"镜像命名规范","slug":"镜像命名规范","link":"#镜像命名规范","children":[]},{"level":2,"title":"Docker 常见命令与参数","slug":"docker-常见命令与参数","link":"#docker-常见命令与参数","children":[]},{"level":2,"title":"拉取镜像流程","slug":"拉取镜像流程","link":"#拉取镜像流程","children":[]},{"level":2,"title":"案例1-利用Nginx容器部署静态资源","slug":"案例1-利用nginx容器部署静态资源","link":"#案例1-利用nginx容器部署静态资源","children":[]},{"level":2,"title":"数据卷","slug":"数据卷","link":"#数据卷","children":[]},{"level":2,"title":"案例2-mysql容器的数据挂载","slug":"案例2-mysql容器的数据挂载","link":"#案例2-mysql容器的数据挂载","children":[]},{"level":2,"title":"自定义镜像","slug":"自定义镜像","link":"#自定义镜像","children":[]},{"level":2,"title":"网络","slug":"网络","link":"#网络","children":[]},{"level":2,"title":"案例 部署Java应用","slug":"案例-部署java应用","link":"#案例-部署java应用","children":[]},{"level":2,"title":"DockerCompose","slug":"dockercompose","link":"#dockercompose","children":[]}],"relativePath":"lang/docker/docker_acqua_basis.md","lastUpdated":1737364285000}'),u={name:"lang/docker/docker_acqua_basis.md"},m=l(`<h1 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-hidden="true">#</a></h1><h2 id="_1-docker-快速入门" tabindex="-1">1.Docker 快速入门 <a class="header-anchor" href="#_1-docker-快速入门" aria-hidden="true">#</a></h2><p>要想让Docker帮我们安装和部署软件，肯定要保证你的机器上有Docker. 由于大家的操作系统各不相同，安装方式也不同。为了便于大家学习，我们统一在CentOS的虚拟机中安装Docker，统一学习环境。</p><div class="warning custom-block"><p class="custom-block-title">提示</p><ul><li>注意：使用MacBook的同学也请利用 VMwareFusion来安装虚拟机，并在虚拟机中学习Docker使用。</li></ul></div><p>安装方式参考文档：《安装Docker》</p><h3 id="_1-1部署mysql" tabindex="-1">1.1部署MYSQL <a class="header-anchor" href="#_1-1部署mysql" aria-hidden="true">#</a></h3><p>首先，我们利用Docker来安装一个MySQL软件，大家可以对比一下之前传统的安装方式，看看哪个效率更高一些。</p><p>如果是利用传统方式部署MySQL，大概的步骤有：</p><ul><li>搜索并下载MySQL安装包</li><li>上传至Linux环境</li><li>编译和配置环境</li><li>安装</li></ul><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ms</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3306</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">3306</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MYSQL_ROOT_PASSWORD=</span><span style="color:#F78C6C;">123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>命令解读</strong></p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">docker run -d \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  --name mysql \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  -p 3306:3306 \\ </span></span>
<span class="line"><span style="color:#A6ACCD;">  -e TZ=Asia/Shanghai \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  -e MYSQL_ROOT_PASSWORD=123 \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  mysql</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>docker run ：创建并运行一个容器，-d 是让容器在后台运行</li><li>--name mysql ：给容器起个名字，必须唯一</li><li>-p 3306:3306 : 设置端口映射。</li></ul><blockquote><p>1、 容器是隔离环境，外界不可访问。但是可以将宿主机端口映射容器内到端口，当访问宿主机指定端口时，就是在访问容器内的端口了。</p></blockquote><blockquote><p>2、 容器内端口往往是由容器内的进程决定，例如MySQL进程默认端口是3306，因此容器内端口一定是3306；而宿主机端口则可以任意指定，一般与容器内保持一致。</p></blockquote><blockquote><p>3、格式： -p 宿主机端口:容器内端口，示例中就是将宿主机的3306映射到容器内的3306端口</p></blockquote><ul><li>-e KEY=VALUE ：是设置环境变量</li><li>mysql ：指定运行的镜像的名字</li></ul><p>运行效果如图： <img src="`+e+'" alt=""></p><p>MySQL安装完毕！通过任意客户端工具即可连接到MySQL.</p><p>大家可以发现，当我们执行命令后，Docker做的第一件事情，是去自动搜索并下载了MySQL，然后会自动运行MySQL，我们完全不用插手，是不是非常方便。</p><p>而且，这种安装方式你完全不用考虑运行的操作系统环境，它不仅仅在CentOS系统是这样，在Ubuntu系统、macOS系统、甚至是装了WSL的Windows下，都可以使用这条命令来安装MySQL。</p><p>要知道，不同操作系统下其安装包、运行环境是都不相同的！如果是手动安装，必须手动解决安装包不同、环境不同的、配置不同的问题！</p><p>而使用Docker，这些完全不用考虑。就是因为Docker会自动搜索并下载MySQL。注意：这里下载的不是安装包，而是镜像。镜像中不仅包含了MySQL本身，还包含了其运行所需要的环境、配置、系统级函数库。因此它在运行时就有自己独立的环境，就可以跨系统运行，也不需要手动再次配置环境了。这套独立运行的隔离环境我们称为容器。</p><h2 id="镜像和容器" tabindex="-1">镜像和容器 <a class="header-anchor" href="#镜像和容器" aria-hidden="true">#</a></h2><p>当我们利用Docker安装应用时，Docker会自动搜索并下载应用镜像（image）。镜像不仅包含应用本身，还包含应用运行所需要的环境、配置、系统函数库。Docker会在运行镜像时创建一个隔离环境，称为容器（container）。 镜像仓库：存储和管理镜像的平台，Docker官方维护了一个公共仓库：Docker Hub。 <img src="'+t+'" alt=""></p><h2 id="docker-介绍" tabindex="-1">Docker 介绍 <a class="header-anchor" href="#docker-介绍" aria-hidden="true">#</a></h2><p><strong>什么是Docker</strong></p><ul><li>Docker可以帮助我们下载应用镜像，创建并运行镜像的容器，从而快速部署应用</li></ul><p><strong>什么是镜像</strong></p><ul><li>将应用所需的函数库、依赖、配置等与应用一起打包得到的就是镜像</li></ul><p><strong>什么是容器</strong></p><ul><li>为每个镜像的应用进程创建的隔离运行环境就是容器</li></ul><p><strong>什么是镜像仓库</strong></p><ul><li>存储和管理镜像的服务就是镜像仓库</li><li>DockerHub是目前最大的镜像仓库，其中包含各种常见的应用镜像</li></ul><h2 id="镜像命名规范" tabindex="-1">镜像命名规范 <a class="header-anchor" href="#镜像命名规范" aria-hidden="true">#</a></h2><p>1、镜像名称一般分两部分组成：[repository]:[tag]。</p><ul><li>其中repository就是镜像名</li><li>tag是镜像的版本</li></ul><p>2、在没有指定tag时，默认是latest，代表最新版本的镜像</p><p><img src="'+p+'" alt=""></p><h2 id="docker-常见命令与参数" tabindex="-1">Docker 常见命令与参数 <a class="header-anchor" href="#docker-常见命令与参数" aria-hidden="true">#</a></h2><p><img src="'+o+'" alt=""></p><p><strong>常见命令</strong></p><table><thead><tr><th><h5 style="width:180px;text-align:center;">指令</h5></th><th><h5 style="width:180px;text-align:center;">说明</h5></th><th><h5 style="width:18 0px;text-align:center;">示例</h5></th></tr></thead><tbody><tr><td><div style="text-align:center;">FROM </div></td><td><div style="text-align:center;">指定基础镜像 </div></td><td><div style="text-align:center;">FROM centos:6</div></td></tr><tr><td><div style="text-align:center;">ENV</div></td><td><div style="text-align:center;">设置环境变量，可在后面指令使用 </div></td><td><div style="text-align:center;">ENV key value </div></td></tr><tr><td><div style="text-align:center;">RUN</div></td><td><div style="text-align:center;">执行Linux的shell命令，一般是安装过程的命令 </div></td><td><div style="text-align:center;">RUN tar -zxvf /tmp/jre11.tar.gz&amp;&amp; EXPORTS path=/tmp/jre11:$path </div></td></tr><tr><td><div style="text-align:center;">EXPOSE</div></td><td><div style="text-align:center;">指定容器运行时监听的端口，是给镜像使用者看的</div></td><td><div style="text-align:center;">EXPOSE 8080</div></td></tr><tr><td><div style="text-align:center;">ENTRYPOINT </div></td><td><div style="text-align:center;">镜像中应用的启动命令，容器运行时调用</div></td><td><div style="text-align:center;">ENTRYPOINT java -jar xx.jar</div></td></tr></tbody></table><p>Docker最常见的命令就是操作镜像、容器的命令，详见官方文档：<a href="https://docs.docker.com/" target="_blank" rel="noreferrer">https://docs.docker.com/ </a></p><p><img src="'+r+`" alt=""></p><h2 id="拉取镜像流程" tabindex="-1">拉取镜像流程 <a class="header-anchor" href="#拉取镜像流程" aria-hidden="true">#</a></h2><p>以Nginx为例，查看DockerHub，拉取Nginx镜像，创建并运行Nginx容器</p><ul><li>在DockerHub中搜索Nginx镜像，查看镜像的名称</li><li>拉取Nginx镜像</li><li>查看本地镜像列表</li><li>创建并运行Nginx容器</li><li>查看容器</li><li>停止容器</li><li>再次启动容器</li><li>进入Nginx容器</li><li>删除容器</li></ul><p><strong>命令示例</strong></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">#镜像相关命令</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">#拉取镜像</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">images</span><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;">#查看镜像列表</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">#删除镜像 可以是（名称或IMAGEID）</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">save</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx.tar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:latest</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># -o 给定镜像保存路径及名称，默认在当前文件下</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">load</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx.tar</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#-i 代表要加载哪个tar文件</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#容器相关命令</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8080</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#创建并运行容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--format</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">table {{.ID}}\\t{{.Image}}\\t{{.Ports}}\\t{{.Status}}\\t{{.Names}}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">#查询所有容器 不带 -a代表只查看运行中的容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#启动容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">#停止容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#删除容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">#进入容器 -it可持续终端 用bash命令进行交互</span></span>
<span class="line"><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#退出容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">logs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">#查看指定容器的日志 -f代表持续输出</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="案例1-利用nginx容器部署静态资源" tabindex="-1">案例1-利用Nginx容器部署静态资源 <a class="header-anchor" href="#案例1-利用nginx容器部署静态资源" aria-hidden="true">#</a></h2><ul><li>创建Nginx容器，修改nginx容器内的html目录下的index.html文件内容P</li><li>将静态资源部署到nginx的html目录</li></ul><p>1、在执行docker run命令时，使用 -v 数据卷:容器内目录 可以完成数据卷挂载</p><p>2、当创建容器时，如果挂载了数据卷且数据卷不存在，会自动创建数据卷</p><div class="warning custom-block"><p class="custom-block-title">提示</p><ul><li>在执行docker run命令时，使用 -v 数据卷:容器内目录 可以完成数据卷挂载</li><li>当创建容器时，如果挂载了数据卷且数据卷不存在，会自动创建数据卷</li></ul></div><h2 id="数据卷" tabindex="-1">数据卷 <a class="header-anchor" href="#数据卷" aria-hidden="true">#</a></h2><p><img src="`+c+'" alt=""></p><table><thead><tr><th><h5 style="width:300px;text-align:center;">命令</h5></th><th><h5 style="width:300px;text-align:center;">说明</h5></th></tr></thead><tbody><tr><td><div style="text-align:center;">docker volume create</div></td><td><div style="text-align:center;">创建数据卷 </div></td></tr><tr><td><div style="text-align:center;">docker volume ls</div></td><td><div style="text-align:center;">查看所有数据卷</div></td></tr><tr><td><div style="text-align:center;">docker volume rm</div></td><td><div style="text-align:center;">删除指定数据卷 </div></td></tr><tr><td><div style="text-align:center;">docker volume inspect</div></td><td><div style="text-align:center;">查看某个数据卷的详情</div></td></tr><tr><td><div style="text-align:center;">docker volume prune</div></td><td><div style="text-align:center;">清除数据卷</div></td></tr></tbody></table><div class="tip custom-block"><p class="custom-block-title">总结</p><p>什么是数据卷？</p><ul><li>数据卷是一个虚拟目录，它将宿主机目录映射到容器内目录，方便我们操作容器内文件，或者方便迁移容器产生的数据。</li></ul><p>如何挂载数据卷？</p><ul><li>在创建容器时，利用 -v 数据卷名：容器内目录完成挂载</li><li>容器创建时，如果发现挂载的数据卷不存在时，会自动创建</li></ul><p>数据卷的常见命令有哪些？</p><ul><li>docker volume ls: 查看数据卷</li><li>docker volume rm: 删除数据卷</li><li>docker volume inspect: 查看数据卷详情</li><li>docker volume prune: 删除未使用的数据卷</li></ul></div><h2 id="案例2-mysql容器的数据挂载" tabindex="-1">案例2-mysql容器的数据挂载 <a class="header-anchor" href="#案例2-mysql容器的数据挂载" aria-hidden="true">#</a></h2><p>需求：</p><ul><li>查看mysql容器，判断是否有数据卷挂载</li><li>基于宿主机目录实现MySQL数据目录、配置文件、初始化脚本的挂载（查阅官方镜像文档）</li></ul><blockquote><p>1、挂载/root/mysql/data到容器内的/var/lib/mysql目录</p></blockquote><blockquote><p>2、挂载/root/mysql/init到容器内的/docker-entrypoint-initdb.d目录，携带课前资料准备的SQL脚本</p></blockquote><blockquote><p>3、挂载/root/mysql/conf到容器内的/etc/mysql/conf.d目录，携带课前资料准备的配置文件</p></blockquote><hr><ul><li>在执行docker run命令时，使用 -v 数据卷:容器内目录 可以完成数据卷挂载</li><li>本地目录必须以“/”或 &quot;./&quot; 开头，如果直接以名称开头，会被识别为数据卷而非本地目录</li></ul><blockquote><p>1、-v mysql : /var/lib/mysql 会被识别为一个数据卷叫mysql</p></blockquote><blockquote><p>2、-v ./mysql : /var/lib/mysql 会被识别为当前目录下的mysql目录</p></blockquote><h2 id="自定义镜像" tabindex="-1">自定义镜像 <a class="header-anchor" href="#自定义镜像" aria-hidden="true">#</a></h2><p>镜像就是包含了应用程序、程序运行的系统函数库、运行配置等文件的文件包。构建镜像的过程其实就是把上述文件打包的过程。</p><table><thead><tr><th><h5 style="width:300px;text-align:center;">部署一个Java应用的步骤：</h5></th><th><h5 style="width:300px;text-align:center;">构建一个Java镜像的步骤：</h5></th></tr></thead><tbody><tr><td><div style="text-align:center;">准备一个Linux服务器 </div></td><td><div style="text-align:center;">准备一个Linux运行环境 </div></td></tr><tr><td><div style="text-align:center;">安装JRE并配置环境变量</div></td><td><div style="text-align:center;">安装JRE并配置环境变量 </div></td></tr><tr><td><div style="text-align:center;">拷贝Jar包</div></td><td><div style="text-align:center;">拷贝Jar包 </div></td></tr><tr><td><div style="text-align:center;">运行Jar包 </div></td><td><div style="text-align:center;">编写运行脚本 </div></td></tr></tbody></table><p><strong>镜像的结构</strong></p><p><img src="'+i+`" alt=""></p><p><strong>Dockerfile</strong></p><p>Dockerfile就是一个文本文件，其中包含一个个的指令(Instruction)，用指令来说明要执行什么操作来构建镜像。将来Docker可以根据Dockerfile帮我们构建镜像。常见指令如下：</p><table><thead><tr><th><h5 style="width:180px;text-align:center;">指令</h5></th><th><h5 style="width:180px;text-align:center;">说明</h5></th><th><h5 style="width:18 0px;text-align:center;">示例</h5></th></tr></thead><tbody><tr><td><div style="text-align:center;">FROM </div></td><td><div style="text-align:center;">指定基础镜像 </div></td><td><div style="text-align:center;">FROM centos:6</div></td></tr><tr><td><div style="text-align:center;">ENV</div></td><td><div style="text-align:center;">设置环境变量，可在后面指令使用 </div></td><td><div style="text-align:center;">ENV key value </div></td></tr><tr><td><div style="text-align:center;">RUN</div></td><td><div style="text-align:center;">执行Linux的shell命令，一般是安装过程的命令 </div></td><td><div style="text-align:center;">RUN tar -zxvf /tmp/jre11.tar.gz&amp;&amp; EXPORTS path=/tmp/jre11:$path </div></td></tr><tr><td><div style="text-align:center;">EXPOSE</div></td><td><div style="text-align:center;">指定容器运行时监听的端口，是给镜像使用者看的</div></td><td><div style="text-align:center;">EXPOSE 8080</div></td></tr><tr><td><div style="text-align:center;">ENTRYPOINT </div></td><td><div style="text-align:center;">镜像中应用的启动命令，容器运行时调用</div></td><td><div style="text-align:center;">ENTRYPOINT java -jar xx.jar</div></td></tr></tbody></table><p>我们可以基于Ubuntu基础镜像，利用Dockerfile描述镜像结构</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 指定基础镜像</span></span>
<span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu:</span><span style="color:#F78C6C;">16.04</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 配置环境变量，JDK的安装目录、容器内时区</span></span>
<span class="line"><span style="color:#FFCB6B;">ENV</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">JAVA_DIR=/usr/local</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 拷贝jdk和java项目的包</span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./jdk8.tar.gz</span><span style="color:#A6ACCD;"> $JAVA_DIR</span><span style="color:#C3E88D;">/</span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./docker-demo.jar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/tmp/app.jar</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 安装JDK</span></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cd</span><span style="color:#A6ACCD;"> $JAVA_DIR \\ </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">tar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-xf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./jdk8.tar.gz</span><span style="color:#A6ACCD;"> \\ </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">mv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./jdk1.8.0_144</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./java8</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 配置环境变量</span></span>
<span class="line"><span style="color:#FFCB6B;">ENV</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">JAVA_HOME=</span><span style="color:#A6ACCD;">$JAVA_DIR</span><span style="color:#C3E88D;">/java8</span></span>
<span class="line"><span style="color:#FFCB6B;">ENV</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">PATH=</span><span style="color:#A6ACCD;">$PATH</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;">$JAVA_HOME</span><span style="color:#C3E88D;">/bin</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 入口，java项目的启动命令</span></span>
<span class="line"><span style="color:#FFCB6B;">ENTRYPOINT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">java</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">-jar</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/app.jar</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>我们可以基于Ubuntu基础镜像，利用Dockerfile描述镜像结构,也可以直接基于JDK为基础镜像，省略前面的步骤：</p><p><img src="`+d+'" alt=""></p><p><img src="'+y+'" alt=""></p><div class="tip custom-block"><p class="custom-block-title">总结</p><p>镜像的结构是怎样的？</p><ul><li>镜像中包含了应用程序所需要的运行环境、函数库、配置、以及应用本身等各种文件，这些文件分层打包而成。</li></ul><p>Dockerfile是做什么的？</p><ul><li>Dockerfile就是利用固定的指令来描述镜像的结构和构建过程，这样Docker才可以依次来构建镜像</li></ul><p>构建镜像的命令是什么？</p><ul><li>docker build -t 镜像名 Dockerfile目录</li></ul></div><h2 id="网络" tabindex="-1">网络 <a class="header-anchor" href="#网络" aria-hidden="true">#</a></h2><p>默认情况下，所有容器都是以bridge方式连接到Docker的一个虚拟网桥上：</p><p><img src="'+C+'" alt=""></p><p>加入自定义网络的容器才可以通过容器名互相访问，Docker的网络操作命令如下:</p><table><thead><tr><th><h5 style="width:300px;text-align:center;">命令</h5></th><th><h5 style="width:300px;text-align:center;">说明</h5></th></tr></thead><tbody><tr><td><div style="text-align:center;">docker network create</div></td><td><div style="text-align:center;">创建一个网络 </div></td></tr><tr><td><div style="text-align:center;">docker network ls</div></td><td><div style="text-align:center;">查看所有网络</div></td></tr><tr><td><div style="text-align:center;">docker network rm</div></td><td><div style="text-align:center;">删除指定网络 </div></td></tr><tr><td><div style="text-align:center;">docker network prune</div></td><td><div style="text-align:center;">清除未使用的网络</div></td></tr><tr><td><div style="text-align:center;">docker network connect</div></td><td><div style="text-align:center;">使指定容器连接加入某网络</div></td></tr><tr><td><div style="text-align:center;">docker network disconnect</div></td><td><div style="text-align:center;">使指定容器连接离开某网络</div></td></tr><tr><td><div style="text-align:center;">docker network inspect </div></td><td><div style="text-align:center;">查看网络详细信息</div></td></tr></tbody></table><h2 id="案例-部署java应用" tabindex="-1">案例 部署Java应用 <a class="header-anchor" href="#案例-部署java应用" aria-hidden="true">#</a></h2><p>需求：将课前资料提供的hmall项目打包为镜像并部署，镜像名hmall</p><p><img src="'+D+'" alt=""></p><h2 id="dockercompose" tabindex="-1">DockerCompose <a class="header-anchor" href="#dockercompose" aria-hidden="true">#</a></h2><p>Docker Compose通过一个单独的docker-compose.yml 模板文件（YAML 格式）来定义一组相关联的应用容器，帮助我们实现多个相互关联的Docker容器的快速部署。</p><p><img src="'+A+'" alt=""></p><p><img src="'+b+`" alt=""></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">version:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3.8</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">services:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">mysql:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">image:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">container_name:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3306:3306</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">environment:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">TZ:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Asia/Shanghai</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">MYSQL_ROOT_PASSWORD:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">123</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">volumes:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./mysql/conf:/etc/mysql/conf.d</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./mysql/data:/var/lib/mysql</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./mysql/init:/docker-entrypoint-initdb.d</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">new</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">hmall:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">build:</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#FFCB6B;">context:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#FFCB6B;">dockerfile:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Dockerfile</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">container_name:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">hmall</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8080:8080</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">new</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">depends_on:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">nginx:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">image:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">container_name:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">18080:18080</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">18081:18081</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">volumes:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./nginx/nginx.conf:/etc/nginx/nginx.conf</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./nginx/html:/etc/nginx/html</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">depends_on:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">hmall</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">new</span></span>
<span class="line"><span style="color:#FFCB6B;">networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">new:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">name:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">hmall</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p><strong>docker compose的命令格式如下：</strong></p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">docker compose [OPTIONS] [COMMAND]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><table><tr><th>类型</th><th>-----------参数或指令-----------</th><th>-------------------说明-------------------</th></tr><tr><td rowspan="2">option</td><td>-f</td><td>指定compose文件的路径和名称</td></tr><tr><td>-p</td><td>指定project名称</td></tr><tr><td rowspan="9">Commands</td><td>up</td><td>创建并启动所有service容器</td></tr><tr><td>down</td><td>停止并移除所有容器、网络</td></tr><tr><td>ps</td><td>列出所有使用的容器</td></tr><tr><td>logs</td><td>查看指定容器的日志</td></tr><tr><td>stop</td><td>停止指定的容器</td></tr><tr><td>start</td><td>启动容器</td></tr><tr><td>restart</td><td>重启容器</td></tr><tr><td>top</td><td>查看运行的进程</td></tr><tr><td>exec</td><td>在指定的运行中容器中执行命令</td></tr></table>`,99),g=[m];function h(v,F,k,x,E,B){return n(),a("div",null,g)}const f=s(u,[["render",h]]);export{q as __pageData,f as default};
